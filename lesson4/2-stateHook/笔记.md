# State Hook

State Hook是一个在函数组件中使用的函数（useState），用于在函数组件中使用状态

useState

- 函数有一个参数，这个参数的值表示状态的默认值(不传递参数,默认值为undefined)
- 函数的返回值是一个数组，该数组一定包含两项
  - 第一项：当前状态的值
  - 第二项：改变状态的函数

一个函数组件中可以有**多个状态**，这种做法非常有利于横向切分关注点。

- 状态表格


## userState原理
```注:每个节点都会附着自己的状态表格 ```
```   所以同一个函数组件状态互不干扰 ```
1. 第1次调用userState
2. 检查该节点的状态表格是否存在下标0
3. 不存在
     1. 使用默认值创建一个状态  
     2. 将该状态加入到状态表格中 index:0  state:0
4. 重新渲染时
   如果存在对应的下标
     1. 忽略掉默认值
     2. 直接得到状态值

1. 第2次调用userState
2. 检查该节点的状态表格是否存在下标1
3. 不存在
     1. 使用默认值创建一个状态  
     2. 将该状态加入到状态表格中 
        index:0  state:0
        index:1  state:true


**注意的细节**

1. useState最好写到函数的起始位置，便于阅读
2. useState严禁出现在代码块（判断、循环）中
3. useState返回的函数（数组的第二项），引用不变（节约内存空间）
4. 使用函数改变数据，若数据和之前的数据完全相等（使用Object.is比较），不会导致重新渲染，以达到优化效率的目的。
5. 使用函数改变数据，传入的值不会和原来的数据进行合并，而是直接替换。
6. 如果要实现强制刷新组件
   1. 类组件：使用forceUpdate函数,强制让组件运行render(不会运行shouldComponentUpdate)
             强制重新渲染
   2. 函数组件：使用一个空对象的useState
7. **如果某些状态之间没有必然的联系，应该分化为不同的状态，而不要合并成一个对象**
8. 和类组件的状态一样，函数组件中改变状态可能是异步的（在DOM事件中），多个状态变化会合并以提高效率，此时，不能信任之前的状态，而应该使用回调函数的方式改变状态。如果状态变化要使用到之前的状态，尽量传递函数。

  setState( n=>{
       return n + 1;
  })
   setState( n=>{ **此时n为上面的n+1**
       return n + 1;
  })